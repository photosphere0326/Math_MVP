<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수학 문제 생성기 테스트</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- MathJax 설정 -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processHtmlTags: true,
                packages: {'[+]': ['ams', 'cases', 'cancel']}
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                ready: () => {
                    console.log('MathJax 준비 완료');
                    MathJax.startup.defaultReady();
                }
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>수학 문제 생성기 (비동기 처리)</h1>
            <p>Celery + Redis 기반 비동기 문제 생성 및 채점 시스템</p>
        </header>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('generation')">문제 생성</button>
            <button class="tab-button" onclick="showTab('worksheets')">문제지 이력</button>
            <button class="tab-button" onclick="showTab('edit')">문제지 편집</button>
            <button class="tab-button" onclick="showTab('grading')">채점</button>
            <button class="tab-button" onclick="showTab('grading-history')">채점 이력</button>
            <button class="tab-button" onclick="showTab('status')">태스크 상태</button>
        </div>

        <!-- 문제 생성 탭 -->
        <div id="generation-tab" class="tab-content active">
            <div class="form-section">
                <h3>문제 생성 설정</h3>
                <form id="generation-form">
                    <div class="form-group">
                        <label for="school-level">학교급:</label>
                        <select id="school-level" required>
                            <option value="중학교">중학교</option>
                            <option value="초등학교">초등학교</option>
                            <option value="고등학교">고등학교</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="grade">학년:</label>
                        <select id="grade" required>
                            <option value="1">1학년</option>
                            <option value="2">2학년</option>
                            <option value="3">3학년</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="semester">학기:</label>
                        <select id="semester" required>
                            <option value="1학기">1학기</option>
                            <option value="2학기">2학기</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="unit-select">대단원 선택:</label>
                        <select id="unit-select" required>
                            <option value="">대단원을 선택하세요</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="chapter-select">소단원 선택:</label>
                        <select id="chapter-select" required disabled>
                            <option value="">먼저 대단원을 선택하세요</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="problem-count">문제 수:</label>
                        <select id="problem-count" required>
                            <option value="10문제">10문제</option>
                            <option value="20문제">20문제</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>난이도 비율:</label>
                        <div class="ratio-group">
                            <label>A단계: <input type="number" id="diff-a" value="30" min="0" max="100">%</label>
                            <label>B단계: <input type="number" id="diff-b" value="40" min="0" max="100">%</label>
                            <label>C단계: <input type="number" id="diff-c" value="30" min="0" max="100">%</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>문제 유형 비율:</label>
                        <div class="ratio-group">
                            <label>객관식: <input type="number" id="type-mc" value="50" min="0" max="100">%</label>
                            <label>주관식: <input type="number" id="type-essay" value="30" min="0" max="100">%</label>
                            <label>단답형: <input type="number" id="type-short" value="20" min="0" max="100">%</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="user-text">세부 요청사항:</label>
                        <textarea id="user-text" placeholder="추가 요청사항을 입력하세요..." rows="3">소인수분해에 관한 다양한 난이도의 문제를 생성해주세요.</textarea>
                    </div>

                    <button type="submit" class="btn-primary">문제 생성 시작</button>
                </form>
            </div>

            <div class="result-section">
                <h3>생성 결과</h3>
                <div id="generation-result"></div>
                <div id="generation-progress" class="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-text">대기 중...</div>
                </div>
            </div>
        </div>

        <!-- 문제지 이력 탭 -->
        <div id="worksheets-tab" class="tab-content">
            <div class="form-section">
                <h3>생성된 문제지 목록</h3>
                <button onclick="loadWorksheets()" class="btn-primary">문제지 목록 새로고침</button>
            </div>

            <div class="result-section">
                <h3>문제지 목록</h3>
                <div id="worksheets-list"></div>
            </div>

            <div class="result-section" id="worksheet-detail-section" style="display: none;">
                <h3>문제지 상세보기</h3>
                <div id="worksheet-detail"></div>
            </div>
        </div>

        <!-- 문제지 편집 탭 -->
        <div id="edit-tab" class="tab-content">
            <div class="form-section">
                <h3>문제지 편집</h3>
                <div class="worksheet-selection">
                    <label for="worksheet-select-edit">편집할 문제지 선택:</label>
                    <select id="worksheet-select-edit">
                        <option value="">문제지를 선택하세요</option>
                    </select>
                    <button onclick="loadWorksheetsForEdit()" class="refresh-btn">새로고침</button>
                </div>
                <button onclick="loadWorksheetForEdit()" class="btn-primary">편집 시작</button>
            </div>

            <!-- 편집 영역 -->
            <div id="edit-worksheet" class="edit-worksheet" style="display: none;">
                <div class="edit-header">
                    <h3>문제지 편집</h3>
                    <div class="edit-controls">
                        <button onclick="saveWorksheet()" class="save-btn">저장</button>
                        <button onclick="cancelEdit()" class="cancel-btn">취소</button>
                    </div>
                </div>

                <!-- 워크시트 기본 정보 편집 -->
                <div class="worksheet-info-edit">
                    <h4>기본 정보</h4>
                    <div class="form-group">
                        <label for="edit-title">제목:</label>
                        <input type="text" id="edit-title" class="edit-input">
                    </div>
                    <div class="form-group">
                        <label for="edit-user-prompt">세부 요청사항:</label>
                        <textarea id="edit-user-prompt" class="edit-textarea" rows="3"></textarea>
                    </div>
                </div>

                <!-- 문제 목록 편집 -->
                <div class="problems-edit">
                    <h4>문제 목록</h4>
                    <div id="problems-list-edit"></div>
                </div>
            </div>

            <div class="result-section">
                <div id="edit-result"></div>
            </div>
        </div>

        <!-- 채점 탭 -->
        <div id="grading-tab" class="tab-content">
            <div class="worksheet-selection-section">
                <div class="exam-header">
                    <h2>수학 시험지 채점</h2>
                    <div class="exam-info">
                        <span>시험일: <span id="exam-date"></span></span>
                        <span>학년: <span id="student-grade"></span></span>
                        <span>이름: ________________</span>
                    </div>
                </div>
                
                <div class="worksheet-selection">
                    <label for="worksheet-select-grading">시험지 선택:</label>
                    <select id="worksheet-select-grading">
                        <option value="">시험지를 선택하세요</option>
                    </select>
                    <button onclick="refreshWorksheetsForGrading()" class="refresh-btn">새로고침</button>
                </div>
                <button onclick="loadSelectedWorksheetForGrading()" class="load-exam-btn">시험지 불러오기</button>
            </div>

            <!-- 시험지 영역 -->
            <div id="exam-paper" class="exam-paper" style="display: none;">
                <div class="exam-paper-header">
                    <div class="school-info">
                        <h3 id="exam-title">수학 시험지</h3>
                        <div class="exam-details">
                            <span>학교: ○○○학교</span>
                            <span>학년: <span id="paper-grade"></span></span>
                            <span>반: ___반</span>
                            <span>번호: ___번</span>
                            <span>이름: ________________</span>
                        </div>
                    </div>
                    <div class="score-box">
                        <div class="score-label">점수</div>
                        <div class="score-value" id="final-score">___/100</div>
                    </div>
                </div>

                <!-- 객관식 문제 영역 -->
                <div id="multiple-choice-section" class="question-section">
                    <h4>1. 객관식 (각 문제당 5점)</h4>
                    <div id="multiple-choice-answers" class="mc-answer-grid"></div>
                </div>

                <!-- 주관식/서술형 문제 영역 -->
                <div id="subjective-section" class="question-section">
                    <h4>2. 주관식/서술형 (각 문제당 10점)</h4>
                    <div id="subjective-answers" class="subjective-area"></div>
                </div>

                <div class="submit-section">
                    <button onclick="submitExamAnswers()" class="submit-exam-btn">답안 제출 및 채점</button>
                </div>
            </div>

            <!-- 채점 결과 영역 -->
            <div class="result-section">
                <div id="grading-result"></div>
                <div id="grading-progress" class="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-text">채점 중...</div>
                </div>
            </div>
        </div>

        <!-- 채점 이력 탭 -->
        <div id="grading-history-tab" class="tab-content">
            <div class="form-section">
                <h3>채점 이력 관리</h3>
                <div class="grading-history-controls">
                    <button onclick="loadGradingHistory()" class="btn-primary">채점 이력 새로고침</button>
                    <div class="filter-section">
                        <label for="worksheet-filter">문제지별 필터:</label>
                        <select id="worksheet-filter" onchange="filterGradingHistory()">
                            <option value="">전체 보기</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="result-section">
                <h3>채점 이력 목록</h3>
                <div id="grading-history-list"></div>
            </div>

            <div class="result-section" id="grading-detail-section" style="display: none;">
                <h3>채점 상세 결과</h3>
                <div id="grading-detail"></div>
            </div>
        </div>

        <!-- 태스크 상태 탭 -->
        <div id="status-tab" class="tab-content">
            <div class="form-section">
                <h3>태스크 상태 조회</h3>
                <div class="form-group">
                    <label for="task-id">태스크 ID:</label>
                    <input type="text" id="task-id" placeholder="태스크 ID 입력">
                </div>
                <button onclick="checkTaskStatus()" class="btn-primary">상태 확인</button>
            </div>

            <div class="result-section">
                <h3>태스크 상태</h3>
                <div id="status-result"></div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>